<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ä°st-Risk | Uydu Destekli Analiz</title>
    
    <!-- Polyfills for older browsers - FALLBACK EKLENDÄ° -->
    <script>
        // Polyfill.io fallback
        (function() {
            var script = document.createElement('script');
            script.src = 'https://cdn.polyfill.io/v3/polyfill.min.js?features=es6,es2017,es2018,es2019,Array.prototype.includes,Object.assign,Promise,fetch';
            script.onerror = function() {
                console.warn('Polyfill.io yÃ¼klenemedi, yerel polyfill kullanÄ±lÄ±yor');
            };
            document.head.appendChild(script);
        })();
    </script>
    
    <!-- Chart.js with fallback - GÃœNCELLENDÄ° -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Chart.js fallback
        if (typeof Chart === 'undefined') {
            console.warn('Chart.js yÃ¼klenemedi, grafik Ã¶zelliÄŸi devre dÄ±ÅŸÄ±');
            // Chart.js yoksa grafik fonksiyonunu devre dÄ±ÅŸÄ± bÄ±rak
            window.grafikGuncelle = function() {
                console.log('Chart.js yÃ¼klÃ¼ deÄŸil, grafik gÃ¶sterilemiyor');
            };
        }
    </script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <button id="darkModeToggle" class="dark-mode-toggle" onclick="toggleDarkMode()">ğŸŒ™</button>

    <div class="dashboard-container">
        
        <div class="sidebar-left">
            <div class="panel-header">
                <div class="icon-wrapper">ğŸ“Š</div>
                <h1>Risk Paneli</h1>
                <p class="subtitle">Uydu destekli detaylÄ± analiz ekranÄ±</p>
            </div>

            <div class="form-group">
                <label class="form-label">âš¡ HIZLI SENARYOLAR</label>
                <div class="quick-scenarios">
                    <button class="scenario-btn" onclick="hizliSenaryo(7.5, 10)">7.5 - 10km</button>
                    <button class="scenario-btn" onclick="hizliSenaryo(7.0, 20)">7.0 - 20km</button>
                    <button class="scenario-btn" onclick="hizliSenaryo(6.5, 30)">6.5 - 30km</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">DEPREM ÅÄ°DDETÄ° (Richter)</label>
                <div class="magnitude-selector">
                    <input type="range" id="depremSiddeti" min="5.0" max="8.0" step="0.1" value="7.0" class="magnitude-slider" oninput="depremSiddetiDegisti()">
                    <div class="magnitude-display">
                        <span id="siddetDegeri">7.0</span>
                        <span class="magnitude-label">Richter</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">MERKEZE UZAKLIK (km)</label>
                <div class="magnitude-selector">
                    <input type="range" id="depremUzaklik" min="0" max="100" step="5" value="20" class="magnitude-slider distance-slider" oninput="depremUzaklikDegisti()">
                    <div class="magnitude-display">
                        <span id="uzaklikDegeri">20</span>
                        <span class="magnitude-label">km</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ä°LÃ‡E SEÃ‡Ä°NÄ°Z</label>
                <select id="ilceListesi" class="modern-select" onchange="analizGetir()">
                    <option value="">-- Listeden SeÃ§in --</option>
                    <optgroup label="Ä°stanbul - Avrupa YakasÄ±">
                        <option value="fatih">Fatih</option>
                        <option value="besiktas">BeÅŸiktaÅŸ</option>
                        <option value="avcilar">AvcÄ±lar</option>
                        <option value="bakirkoy">BakÄ±rkÃ¶y</option>
                        <option value="sariyer">SarÄ±yer</option>
                        <option value="basaksehir">BaÅŸakÅŸehir</option>
                        <option value="sisli">ÅiÅŸli</option>
                        <option value="zeytinburnu">Zeytinburnu</option>
                        <option value="beylikduzu">BeylikdÃ¼zÃ¼</option>
                        <option value="esenyurt">Esenyurt</option>
                        <option value="kagithane">KaÄŸÄ±thane</option>
                        <option value="buyukcekmece">BÃ¼yÃ¼kÃ§ekmece</option>
                    </optgroup>
                    <optgroup label="Edirne">
                        <option value="edirne_merkez">Edirne Merkez</option>
                    </optgroup>
                    <optgroup label="TekirdaÄŸ">
                        <option value="tekirdag_merkez">TekirdaÄŸ Merkez</option>
                    </optgroup>
                    <optgroup label="KÄ±rklareli">
                        <option value="kirklareli_merkez">KÄ±rklareli Merkez</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ”„ KARÅILAÅTIRMA MODU</label>
                <button id="karsilastirmaBtn" class="toggle-btn" onclick="toggleKarsilastirma()">KapalÄ±</button>
                <select id="karsilastirmaIlce" class="modern-select" style="display:none; margin-top:10px;" onchange="karsilastirmaYap()">
                    <option value="">KarÅŸÄ±laÅŸtÄ±rÄ±lacak ilÃ§e seÃ§in</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">â­ FAVORÄ° Ä°LÃ‡ELER</label>
                <div id="favoriIlceler" class="favorites-list"></div>
            </div>

            <div id="veriKutusu" class="data-card" style="display:none;">
                <div class="data-header">Analiz DetaylarÄ±</div>
                <div class="data-row">
                    <span class="data-label">Zemin</span>
                    <span class="data-val" id="zemin">-</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Bina</span>
                    <span class="data-val" id="bina">-</span>
                </div>
                <div class="data-row">
                    <span class="data-label">NÃ¼fus</span>
                    <span class="data-val" id="nufus">-</span>
                </div>
                <div class="data-row highlight">
                    <span class="data-label">GÃ¼venlik PuanÄ±</span>
                    <span class="data-val risk-score" id="puan">-</span>
                </div>
            </div>

            <div id="hasarKutusu" class="damage-card" style="display:none;">
                <div class="damage-header">
                    <span class="damage-icon">ğŸšï¸</span>
                    <span>Hasar Tahmini</span>
                </div>
                <div class="damage-stats">
                    <div class="damage-stat">
                        <span class="damage-label">Toplam Bina</span>
                        <span class="damage-value" id="toplamBina">-</span>
                    </div>
                    <div class="damage-stat critical">
                        <span class="damage-label">HasarlÄ± Bina</span>
                        <span class="damage-value" id="hasarliBina">-</span>
                    </div>
                    <div class="damage-stat">
                        <span class="damage-label">Hasar OranÄ±</span>
                        <span class="damage-value" id="hasarOrani">-</span>
                    </div>
                </div>
                <div class="damage-bar-container">
                    <div class="damage-bar" id="hasarBar"></div>
                </div>
            </div>

            <div id="degerlendirmeKutusu" class="evaluation-card" style="display:none;">
                <div class="evaluation-header">DeÄŸerlendirme</div>
                <p id="degerlendirmeMetni" class="evaluation-text"></p>
                
                <div id="kaynakBilgisi" class="sources-info" style="display:none;">
                    <div class="sources-header">ğŸ“š Resmi Kaynaklar</div>
                    <div id="kaynakListesi" class="sources-list"></div>
                </div>
            </div>

            <div class="all-districts-damage">
                <div class="damage-header">
                    <span class="damage-icon">ğŸ“‹</span>
                    <span>TÃ¼m Ä°lÃ§eler Hasar Durumu</span>
                </div>
                <div id="tumIlcelerHasar" class="damage-table-container"></div>
            </div>

            <!-- RESMÄ° KAYNAKLAR BÃ–LÃœMÃœ -->
            <div class="official-sources-card">
                <div class="sources-title">ğŸ“š Resmi Veri KaynaklarÄ±</div>
                <div class="sources-content">
                    <div class="source-item">
                        <strong>ğŸ—ºï¸ AFAD TDTH</strong>
                        <p>TÃ¼rkiye Deprem Tehlike HaritasÄ± - Yer Ä°vmesi (PGA) deÄŸerleri</p>
                        <a href="https://tdth.afad.gov.tr" target="_blank" class="source-link">tdth.afad.gov.tr</a>
                        <p style="font-size:10px; color:#6b7280; margin-top:4px;">Not: 2019'dan itibaren derece sistemi kaldÄ±rÄ±lmÄ±ÅŸ, yer ivmesi (PGA) kullanÄ±lmaktadÄ±r.</p>
                    </div>
                    <div class="source-item">
                        <strong>ğŸ§­ MTA</strong>
                        <p>Yerbilimleri Harita GÃ¶rÃ¼ntÃ¼leyicisi - Aktif fay hatlarÄ± ve jeoloji</p>
                        <a href="https://yerbilimleri.mta.gov.tr" target="_blank" class="source-link">yerbilimleri.mta.gov.tr</a>
                    </div>
                    <div class="source-item">
                        <strong>ğŸ“Š Kandilli</strong>
                        <p>Deprem Bilgi Sistemi - Sismik veriler ve deprem kayÄ±tlarÄ±</p>
                        <a href="https://www.koeri.boun.edu.tr" target="_blank" class="source-link">koeri.boun.edu.tr</a>
                    </div>
                    <div class="source-item">
                        <strong>â„¹ï¸ Not</strong>
                        <p style="font-size:11px; color:#6b7280;">e-Devlet platformu harita Ã¼retmez, AFAD TDTH haritasÄ±nÄ± gÃ¶rÃ¼ntÃ¼leme hizmeti sunar. TÃ¼m veriler AFAD TÃ¼rkiye Deprem Tehlike HaritasÄ± (TDTH) kaynaklÄ±dÄ±r.</p>
                    </div>
                </div>
            </div>

            <div class="gps-status">
                <div class="status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span>GPS Durumu: <span id="konumDurumu">Bekleniyor...</span></span>
                </div>
                <button onclick="konumIste()" class="location-button" style="margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; width: 100%;">
                    ğŸ“ Konumumu Bul
                </button>
            </div>

            <div id="actionButtons" class="action-buttons" style="display:none;">
                <button class="action-btn share-btn" onclick="paylas()">ğŸ“¤ PaylaÅŸ</button>
                <button class="action-btn download-btn" onclick="pdfIndir()">ğŸ“¥ PDF Ä°ndir</button>
            </div>
        </div>

        <div class="main-content">
            <iframe id="uyduHarita" 
                src="https://maps.google.com/maps?q=Istanbul&t=k&z=10&ie=UTF8&iwloc=&output=embed" 
                allowfullscreen>
            </iframe>
            
            <div class="image-overlay">
                <div class="overlay-content">
                    <span id="riskBadge" class="risk-badge">BEKLEMEDE</span>
                    <h1 id="buyukBaslik" class="location-title">Ä°stanbul</h1>
                    <p id="aciklamaMetni" class="location-description">Analiz ve uydu gÃ¶rÃ¼ntÃ¼sÃ¼ iÃ§in seÃ§im yapÄ±n.</p>
                </div>
            </div>

            <div id="grafikPanel" class="chart-panel" style="display:none;">
                <canvas id="hasarGrafik"></canvas>
            </div>
        </div>

        <div class="sidebar-right">
            <div class="suggestion-box safe-box">
                <div class="box-header">
                    <span class="box-icon">âœ…</span>
                    <h2>GÃ¼venli BÃ¶lgeler</h2>
                </div>
                <div id="guvenliListe" class="list-container"></div>
            </div>
            
            <div class="suggestion-box risk-box">
                <div class="box-header">
                    <span class="box-icon">âš ï¸</span>
                    <h2>Riskli BÃ¶lgeler</h2>
                </div>
                <div id="riskliListe" class="list-container"></div>
            </div>

            <div class="suggestion-box preparation-box">
                <div class="box-header">
                    <span class="box-icon">ğŸ“¦</span>
                    <h2>Deprem HazÄ±rlÄ±ÄŸÄ±</h2>
                </div>
                <div class="preparation-content">
                    <div class="prep-item">
                        <span class="prep-icon">ğŸ’</span>
                        <div class="prep-text">
                            <strong>Acil Durum Ã‡antasÄ±</strong>
                            <p>Su, gÄ±da, ilaÃ§, fener, radyo, dÃ¼dÃ¼k hazÄ±rlayÄ±n</p>
                        </div>
                    </div>
                    <div class="prep-item">
                        <span class="prep-icon">ğŸ </span>
                        <div class="prep-text">
                            <strong>Bina GÃ¼venliÄŸi</strong>
                            <p>Dolap, raf ve aÄŸÄ±r eÅŸyalarÄ± duvara sabitleyin</p>
                        </div>
                    </div>
                    <div class="prep-item">
                        <span class="prep-icon">ğŸ“±</span>
                        <div class="prep-text">
                            <strong>Ä°letiÅŸim PlanÄ±</strong>
                            <p>Aile Ã¼yeleriyle buluÅŸma noktasÄ± belirleyin</p>
                        </div>
                    </div>
                    <div class="prep-item">
                        <span class="prep-icon">ğŸšª</span>
                        <div class="prep-text">
                            <strong>Ã‡Ä±kÄ±ÅŸ YollarÄ±</strong>
                            <p>GÃ¼venli Ã§Ä±kÄ±ÅŸ yollarÄ±nÄ± Ã¶nceden belirleyin</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="suggestion-box action-box">
                <div class="box-header">
                    <span class="box-icon">âš¡</span>
                    <h2>Deprem AnÄ±nda</h2>
                </div>
                <div class="action-content">
                    <div class="action-step">
                        <div class="step-number">1</div>
                        <div class="step-text">
                            <strong>Ã‡Ã–K</strong>
                            <p>Yere Ã§Ã¶kÃ¼n, baÅŸÄ±nÄ±zÄ± koruyun</p>
                        </div>
                    </div>
                    <div class="action-step">
                        <div class="step-number">2</div>
                        <div class="step-text">
                            <strong>KAPAN</strong>
                            <p>SaÄŸlam bir eÅŸyanÄ±n yanÄ±na kapanÄ±n</p>
                        </div>
                    </div>
                    <div class="action-step">
                        <div class="step-number">3</div>
                        <div class="step-text">
                            <strong>TUTUN</strong>
                            <p>EÅŸyaya sÄ±kÄ±ca tutunun</p>
                        </div>
                    </div>
                    <div class="action-warning">
                        <span class="warning-icon">âš ï¸</span>
                        <p><strong>AsansÃ¶r kullanmayÄ±n!</strong> Merdivenleri kullanÄ±n</p>
                    </div>
                </div>
            </div>

            <div class="suggestion-box after-box">
                <div class="box-header">
                    <span class="box-icon">ğŸ†˜</span>
                    <h2>Deprem SonrasÄ±</h2>
                </div>
                <div class="after-content">
                    <div class="after-item">
                        <span class="after-icon">ğŸ“</span>
                        <p><strong>112</strong> - Acil YardÄ±m</p>
                    </div>
                    <div class="after-item">
                        <span class="after-icon">ğŸ“</span>
                        <p><strong>110</strong> - Ä°tfaiye</p>
                    </div>
                    <div class="after-tips">
                        <p>âœ… Gaz ve elektriÄŸi kapatÄ±n</p>
                        <p>âœ… Ã‡evrenizdeki yaralÄ±lara yardÄ±m edin</p>
                        <p>âœ… Radyo dinleyerek bilgi alÄ±n</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Compatibility script -->
    <script>
        // ES6+ Feature Detection and Polyfills
        (function() {
            // Object.assign polyfill
            if (typeof Object.assign != 'function') {
                Object.assign = function(target) {
                    if (target == null) {
                        throw new TypeError('Cannot convert undefined or null to object');
                    }
                    var to = Object(target);
                    for (var index = 1; index < arguments.length; index++) {
                        var nextSource = arguments[index];
                        if (nextSource != null) {
                            for (var nextKey in nextSource) {
                                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                                    to[nextKey] = nextSource[nextKey];
                                }
                            }
                        }
                    }
                    return to;
                };
            }

            // Array.includes polyfill
            if (!Array.prototype.includes) {
                Array.prototype.includes = function(searchElement) {
                    return this.indexOf(searchElement) !== -1;
                };
            }

            // String.includes polyfill
            if (!String.prototype.includes) {
                String.prototype.includes = function(search) {
                    return this.indexOf(search) !== -1;
                };
            }

            // Number.isNaN polyfill
            if (!Number.isNaN) {
                Number.isNaN = function(value) {
                    return value !== value;
                };
            }

            // AbortSignal polyfill (basit)
            if (typeof AbortSignal === 'undefined') {
                window.AbortSignal = function() {};
                AbortSignal.timeout = function() { return {}; };
            }
        })();
    </script>

    <script src="script.js"></script>
</body>
</html>